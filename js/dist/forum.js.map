{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@mediaconstructor/ads/./src/forum/safelyEvalAdScript.ts","webpack://@mediaconstructor/ads/webpack/bootstrap","webpack://@mediaconstructor/ads/webpack/runtime/compat get default export","webpack://@mediaconstructor/ads/webpack/runtime/define property getters","webpack://@mediaconstructor/ads/webpack/runtime/hasOwnProperty shorthand","webpack://@mediaconstructor/ads/webpack/runtime/make namespace object","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['forum/app']\"","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['common/extend']\"","webpack://@mediaconstructor/ads/./src/forum/RefreshAds.ts","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@mediaconstructor/ads/./src/forum/areAdsBypassed.ts","webpack://@mediaconstructor/ads/./src/forum/areAdsShown.ts","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['forum/components/DiscussionHero']\"","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['forum/components/DiscussionListPane']\"","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@mediaconstructor/ads/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@mediaconstructor/ads/./src/forum/index.ts","webpack://@mediaconstructor/ads/./src/forum/InsertHeaderAd.tsx","webpack://@mediaconstructor/ads/./src/forum/InsertDiscussionPageHeaderAd.tsx","webpack://@mediaconstructor/ads/./src/forum/InsertFooterAd.tsx","webpack://@mediaconstructor/ads/./src/forum/InsertBetweenPostsAds.tsx","webpack://@mediaconstructor/ads/./src/forum/InsertSidebarAd.tsx","webpack://@mediaconstructor/ads/./src/forum/InsertDiscussionSidebarAd.tsx"],"sourcesContent":["/**\n * Evals JS ad code without risking it bricking the forum frontend.\n *\n * **Please note that \"safe\" does not refer to preventing Javascript exploits or XSS attacks.**\n *\n * @param adPosition A name to show for the ad location\n * @param script The Javascript code to be eval-ed\n */\nexport default function safelyEvalAdScript(adPosition: string, script: string): void {\n  try {\n    eval(script);\n  } catch (e) {\n    console.group('[mediaconstructor/ads] Failed to execute ad script');\n    console.info(`An exception occurred while evaluating the ad script for location \"${adPosition}\".\n\nTo prevent your forum frontend breaking, we caught the error. Please be aware, however, that this may prevent your ads functioning in some cases.`);\n    console.info(\n      `The stacktrace will be logged below to help you identify the issue. This may reference the ads extension, but the likelihood that the issue lies in there is extraordinarily miniscule.`\n    );\n    console.error(e);\n    console.groupEnd();\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","export default function RefreshAds() {\n  let attempts = 0;\n\n  try {\n    attempts++;\n    // @ts-ignore\n    (adsbygoogle = window.adsbygoogle || []).push({});\n  } catch {\n    if (attempts < 10) setTimeout(RefreshAds, 1000);\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","import app from 'flarum/forum/app';\n\nexport default function areAdsBypassed() {\n  return app.forum.attribute<boolean>('canBypassAds');\n}\n","import app from 'flarum/forum/app';\n\nexport default function areAdsShown() {\n  return app.forum.attribute<boolean>('canViewAds');\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionHero'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListPane'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","import app from 'flarum/forum/app';\nimport type { AdUnitLocations } from 'src/common/AdUnitLocations';\nimport InsertBetweenPostsAds from './InsertBetweenPostsAds';\n\nimport InsertDiscussionPageHeaderAd from './InsertDiscussionPageHeaderAd';\nimport InsertDiscussionSidebarAd from './InsertDiscussionSidebarAd';\nimport InsertFooterAd from './InsertFooterAd';\nimport InsertHeaderAd from './InsertHeaderAd';\nimport InsertSidebarAd from './InsertSidebarAd';\n\napp.initializers.add('mediaconstructor/ads', () => {\n  const enabledSlots: AdUnitLocations[] = JSON.parse(app.data['mediaconstructor-ads.enabled-ad-locations']);\n\n  if (enabledSlots.includes('header')) {\n    InsertHeaderAd();\n  }\n\n  if (enabledSlots.includes('discussion_header')) {\n    InsertDiscussionPageHeaderAd();\n  }\n\n  if (enabledSlots.includes('footer')) {\n    InsertFooterAd();\n  }\n\n  if (enabledSlots.includes('between_posts')) {\n    InsertBetweenPostsAds();\n  }\n\n  if (enabledSlots.includes('sidebar')) {\n    InsertSidebarAd();\n  }\n\n  if (enabledSlots.includes('discussion_sidebar')) {\n    InsertDiscussionSidebarAd();\n  }\n});\n","import app from 'flarum/forum/app';\n\nimport { extend, override } from 'flarum/common/extend';\n\nimport IndexPage from 'flarum/forum/components/IndexPage';\n\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\nimport areAdsShown from './areAdsShown';\n\nexport default function InsertHeaderAd() {\n  const AdCode = app.data['mediaconstructor-ads.ad-code.header'] as string;\n  const Script = app.data['mediaconstructor-ads.ad-code.header.js'] as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  override(IndexPage.prototype, 'hero', function (originalHero: () => Mithril.Children): Mithril.Children {\n    if (areAdsBypassed() && !areAdsShown()) console.log(app.forum.attribute);\n    if (areAdsBypassed() && !areAdsShown()) return originalHero();\n\n    return (\n      <>\n        {originalHero()}\n        <div align=\"center\" class=\"mediaconstructor-ad mediaconstructor-ad-header\">\n          {Html}\n        </div>\n      </>\n    );\n  });\n\n  extend(IndexPage.prototype, ['oncreate', 'onupdate'], function (this: IndexPage, returned: any) {\n    if (areAdsBypassed() && !areAdsShown()) return;\n\n    RefreshAds();\n    safelyEvalAdScript('header', Script);\n  });\n}\n","import app from 'flarum/forum/app';\n\nimport { extend, override } from 'flarum/common/extend';\n\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport DiscussionHero from 'flarum/forum/components/DiscussionHero';\nimport DiscussionListPane from 'flarum/forum/components/DiscussionListPane';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\n\nimport listItems from 'flarum/common/helpers/listItems';\n\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\nimport areAdsShown from './areAdsShown';\n\nexport default function InsertDiscussionPageHeaderAd() {\n  const AdCode = app.data['mediaconstructor-ads.ad-code.discussion_header'] as string;\n  const Script = app.data['mediaconstructor-ads.ad-code.discussion_header.js'] as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  override(DiscussionPage.prototype, 'view', function (this: DiscussionPage, originalFunc: () => Mithril.Children): Mithril.Children {\n    if (areAdsBypassed() && !areAdsShown()) return originalFunc();\n\n    const discussion = this.discussion;\n\n    return (\n      <div className=\"DiscussionPage\">\n        <DiscussionListPane state={app.discussions} />\n        <div className=\"DiscussionPage-discussion\">\n          {discussion ? (\n            [\n              DiscussionHero.component({ discussion }),\n              <div className=\"container\">\n                <nav className=\"DiscussionPage-nav\">\n                  <ul>{listItems(this.sidebarItems().toArray())}</ul>\n                </nav>\n                <div className=\"DiscussionPage-stream\">\n                  <div class=\"mediaconstructor-ad mediaconstructor-ad-discussion-header\" align=\"center\">\n                    {Html}\n                  </div>\n\n                  {PostStream.component({\n                    discussion,\n                    stream: this.stream,\n                    onPositionChange: this.positionChanged.bind(this),\n                  })}\n                </div>\n              </div>,\n            ]\n          ) : (\n            <LoadingIndicator />\n          )}\n        </div>\n      </div>\n    );\n  });\n\n  extend(DiscussionPage.prototype, ['oncreate', 'onupdate'], function (this: DiscussionHero, returned: any) {\n    if (areAdsBypassed() && !areAdsShown()) return;\n\n    RefreshAds();\n    safelyEvalAdScript('discussion page header', Script);\n  });\n}\n","import app from 'flarum/forum/app';\nimport areAdsBypassed from './areAdsBypassed';\nimport areAdsShown from './areAdsShown';\nimport RefreshAds from './RefreshAds';\nimport safelyEvalAdScript from './safelyEvalAdScript';\n\nexport default function InsertFooterAd() {\n  setTimeout(() => {\n    if (areAdsBypassed() && !areAdsShown()) return;\n\n    const AdCode = app.data['mediaconstructor-ads.ad-code.footer'] as string;\n    const Script = app.data['mediaconstructor-ads.ad-code.footer.js'] as string;\n\n    const footer = document.createElement('footer');\n    footer.className = 'mediaconstructor-ad mediaconstructor-ad-footer';\n    footer.setAttribute('align', 'center');\n\n    document.querySelector('.App-content')!.append(footer);\n\n    footer.innerHTML = AdCode;\n\n    // Hacky way to detect URL change and re-create ad tag\n\n    const pushState = history.pushState;\n    history.pushState = function (...args) {\n      pushState.apply(history, args);\n\n      footer.innerHTML = AdCode;\n\n      RefreshAds();\n      safelyEvalAdScript('footer', Script);\n    };\n\n    RefreshAds();\n  }, 0);\n}\n","import app from 'flarum/forum/app';\n\nimport { extend, override } from 'flarum/common/extend';\n\nimport RefreshAds from './RefreshAds';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\nimport areAdsShown from './areAdsShown';\n\nimport type Mithril from 'mithril';\n\nexport default function InsertBetweenPostsAds() {\n  const AdCode = app.data['mediaconstructor-ads.ad-code.between_posts'] as string;\n  const Script = app.data['mediaconstructor-ads.ad-code.between_posts.js'] as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  override(PostStream.prototype, 'view', function (originalView: () => Mithril.Vnode<any, any>): Mithril.Children {\n    if (areAdsBypassed() && !areAdsShown()) return originalView();\n\n    const items = originalView().children as Mithril.Children[];\n\n    const newItems = items.reduce((itemList, currentItem, i) => {\n      const curr = [...itemList, currentItem];\n\n      if (i + 1 < items.length && i % (parseInt(app.data['mediaconstructor-ads.between-n-posts'] as string) || 15) === 0) {\n        curr.push(\n          <aside key={`mediaconstructor-ad-${i}`} class=\"PostStream-item\">\n            <div class=\"mediaconstructor-ad mediaconstructor-ad-between-posts\">{Html}</div>\n          </aside>\n        );\n      }\n\n      return curr;\n    }, [] as any[]);\n\n    if (app.data['mediaconstructor-ads.enable-ad-after-placeholder'] === '1') {\n      newItems.push(\n        <aside key={`mediaconstructor-ad-after-placeholder`} class=\"PostStream-item\">\n          <div class=\"mediaconstructor-ad mediaconstructor-ad-between-posts mediaconstructor-ad-between-posts--after-placeholder\">{Html}</div>\n        </aside>\n      );\n    }\n\n    return <div className=\"PostStream\">{newItems}</div>;\n  });\n\n  extend(PostStream.prototype, ['onupdate', 'oncreate'], (originalReturnVal: any) => {\n    if (areAdsBypassed() && !areAdsShown()) return;\n\n    RefreshAds();\n    safelyEvalAdScript('between posts', Script);\n  });\n}\n","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\n\nimport IndexPage from 'flarum/forum/components/IndexPage';\n\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport type ItemList from 'flarum/common/utils/ItemList';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\nimport areAdsShown from './areAdsShown';\n\nexport default function InsertSidebarAd() {\n  const root = document.querySelector(':root') as HTMLHtmlElement;\n\n  const AdCode = app.data['mediaconstructor-ads.ad-code.sidebar'] as string;\n  const Script = app.data['mediaconstructor-ads.ad-code.sidebar.js'] as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  extend(IndexPage.prototype, 'sidebarItems', function (this: IndexPage, items: ItemList<Mithril.Children>) {\n    if ((areAdsBypassed() && !areAdsShown()) || app.current.get('routeName') === 'tags') return;\n\n    // Only show sidebar ad on desktop and tablet\n    if (['desktop-hd', 'desktop', 'tablet'].includes(getComputedStyle(root).getPropertyValue('--flarum-screen'))) {\n      items.add('mediaconstructor-ads', <div class=\"mediaconstructor-ad mediaconstructor-ad-sidebar\">{Html}</div>, -1000);\n    }\n  });\n\n  extend(IndexPage.prototype, ['oncreate', 'onupdate'], function (this: IndexPage, returned: any) {\n    if ((areAdsBypassed() && !areAdsShown()) || app.current.get('routeName') === 'tags') return;\n\n    RefreshAds();\n    safelyEvalAdScript('sidebar', Script);\n  });\n}\n","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\n\nimport IndexPage from 'flarum/forum/components/IndexPage';\n\nimport type * as Mithril from 'mithril';\nimport RefreshAds from './RefreshAds';\nimport type ItemList from 'flarum/common/utils/ItemList';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport safelyEvalAdScript from './safelyEvalAdScript';\nimport areAdsBypassed from './areAdsBypassed';\nimport areAdsShown from './areAdsShown';\n\nexport default function InsertDiscussionSidebarAd() {\n  const root = document.querySelector(':root') as HTMLHtmlElement;\n\n  const AdCode = app.data['mediaconstructor-ads.ad-code.discussion_sidebar'] as string;\n  const Script = app.data['mediaconstructor-ads.ad-code.discussion_sidebar.js'] as string;\n\n  const Html = m.trust(AdCode) as ReturnType<Mithril.Static['trust']>;\n\n  root.style.setProperty('--mediaconstructor-ads--discussion-sidebar-position', '36px');\n\n  extend(DiscussionPage.prototype, 'sidebarItems', function (this: IndexPage, items: ItemList<Mithril.Children>) {\n    if (areAdsBypassed() && !areAdsShown()) return;\n\n    // Only show sidebar ad on desktop and tablet\n    if (['desktop-hd', 'desktop', 'tablet'].includes(getComputedStyle(root).getPropertyValue('--flarum-screen'))) {\n      items.add('mediaconstructor-ads', <div class=\"mediaconstructor-ad mediaconstructor-ad-discussion-sidebar\">{Html}</div>, 1000);\n    }\n  });\n\n  extend(DiscussionPage.prototype, ['oncreate', 'onupdate'], function (this: IndexPage, returned: any) {\n    if (areAdsBypassed() && !areAdsShown()) return;\n\n    RefreshAds();\n    safelyEvalAdScript('discussion sidebar', Script);\n  });\n}\n"],"names":["safelyEvalAdScript","adPosition","script","eval","e","console","group","info","error","groupEnd","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","flarum","core","compat","RefreshAds","attempts","adsbygoogle","window","push","setTimeout","areAdsBypassed","app","attribute","areAdsShown","add","AdCode","Script","Html","enabledSlots","JSON","parse","includes","m","trust","override","IndexPage","originalHero","log","align","class","extend","returned","DiscussionPage","originalFunc","discussion","this","className","state","DiscussionHero","listItems","sidebarItems","toArray","PostStream","stream","onPositionChange","positionChanged","bind","InsertDiscussionPageHeaderAd","footer","document","createElement","setAttribute","querySelector","append","innerHTML","pushState","history","args","apply","originalView","items","children","newItems","reduce","itemList","currentItem","i","curr","length","parseInt","originalReturnVal","InsertBetweenPostsAds","root","getComputedStyle","getPropertyValue","InsertSidebarAd","style","setProperty","InsertDiscussionSidebarAd"],"sourceRoot":""}